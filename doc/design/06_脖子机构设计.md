# 模块 6：脖子机构设计

> 3 DOF：差动 Pitch/Roll (2 舵机) + Yaw (1 舵机)  
> 总计 3 个 **SM30BL 无刷静音舵机** (RS485 总线)

---

## 1. 方案概述

采用 **差动并联 + 底部旋转** 的组合方案：

- **上层**：2 个舵机通过连杆差动驱动 → Pitch (点头) + Roll (歪头)
- **下层**：1 个舵机直接旋转 → Yaw (转头)

```
                     头部
                      ○
                 ╱    │    ╲
            连杆╱     │     ╲连杆
              ╱    铝板支架    ╲
            ╱   ┌─────┴─────┐   ╲
           ╱    │           │    ╲
          ↙     └───────────┘     ↘
    ┌──────────┐              ┌──────────┐
    │ 左舵机    │              │ 右舵机    │   ← Pitch/Roll 差动
    │ SM30BL   │              │ SM30BL   │
    └────┬─────┘              └────┬─────┘
         └───────────┬────────────┘
                     │
              ┌──────┴──────┐
              │  Yaw 舵机    │   ← 底部旋转
              │  SM30BL     │
              └──────┬──────┘
                ═════╧═════
                  底座/躯干
```

## 2. 差动驱动原理

两个舵机协同工作，**通过同向/反向旋转组合出两个运动轴**：

| 左舵机 | 右舵机 | 合成运动              |
| ------ | ------ | --------------------- |
| ↑ 同向 | ↑ 同向 | **Pitch — 低头**      |
| ↓ 同向 | ↓ 同向 | **Pitch — 抬头**      |
| ↑ 反向 | ↓ 反向 | **Roll — 右歪头**     |
| ↓ 反向 | ↑ 反向 | **Roll — 左歪头**     |
| ↑ 混合 | → 混合 | **Pitch + Roll 同时** |

### 控制公式

```python
# Differential neck control
def neck_diff_control(pitch_angle, roll_angle):
    """
    pitch_angle: target pitch in degrees (+ = nod down, - = look up)
    roll_angle:  target roll in degrees  (+ = tilt right, - = tilt left)

    Returns: (left_servo_angle, right_servo_angle)
    """
    left_servo  = pitch_angle + roll_angle
    right_servo = pitch_angle - roll_angle
    return left_servo, right_servo
```

## 3. 运动范围

| 运动                  | 范围    | 说明         |
| --------------------- | ------- | ------------ |
| **Pitch (点头/抬头)** | ±30-40° | 左右舵机同向 |
| **Roll (歪头)**       | ±25-30° | 左右舵机反向 |
| **Yaw (转头)**        | ±90°    | 底部舵机独立 |

## 4. 机构细节

### 4.1 上层：差动 Pitch/Roll

```
    正面视图

    ┌────────── 头部连接法兰 ──────────┐
    │              ◎ 万向铰接           │  ← 头部通过万向节连接
    │         ╱         ╲              │
    │    连杆╱           ╲连杆         │
    │      ╱               ╲           │
    │    ╱                   ╲         │
    ├──╱─────────────────────╲────────┤
    │╱                         ╲      │
    ◎─ 左舵机圆盘摇臂   右舵机圆盘摇臂 ─◎│
    │  ┌──────┐         ┌──────┐      │
    │  │  左  │         │  右  │      │
    │  │SM30BL │        │SM30BL │     │
    │  └──────┘         └──────┘      │
    └──────────────┬──────────────────┘
                   │
             安装在 Yaw 转盘上
```

### 关键尺寸

| 零件         | 尺寸           | 说明                       |
| ------------ | -------------- | -------------------------- |
| 左右舵机间距 | ~70-80mm       | 两舵机中心距               |
| 连杆长度     | ~60-80mm       | 金属杆 Ø3mm                |
| 圆盘摇臂直径 | ~30-40mm       | 铝合金，带连杆孔           |
| 铝板支架     | V 型，高 ~40mm | 固定在舵机安装板上         |
| 头部连接点   | 万向铰接       | 允许 Pitch + Roll 两轴转动 |

### 连杆连接方式

```
    侧视图

         头部法兰
            │
         万向铰接 ◎ ← 球铰 或 十字万向节
           ╱ ╲
          ╱   ╲
    连杆 ╱     ╲ 连杆        ← Ø3mm 金属杆 + M3 鱼眼轴承(两端)
        ╱       ╲
       ╱         ╲
   ┌──◎──┐   ┌──◎──┐
   │圆盘  │   │圆盘  │      ← 舵机圆盘摇臂上的连接点
   │摇臂  │   │摇臂  │         偏心位置 (距中心 15-20mm)
   └──┬───┘   └──┬───┘
      │           │
   左舵机      右舵机
```

### 4.2 下层：Yaw 旋转

```
    俯视图

              ┌─────────────────┐
              │  差动机构        │
              │  (左右舵机+支架) │
              └────────┬────────┘
                       │
              ┌────────┴────────┐
              │   旋转转盘       │  ← Yaw 舵机的输出法兰
              │                 │     整个上层跟着转
              └────────┬────────┘
                       │
              ┌────────┴────────┐
              │   Yaw 舵机       │  ← SM30BL, 垂直安装
              │   SM30BL        │     输出轴朝上
              └────────┬────────┘
                  ═════╧═════
                    底座
```

## 5. 优势分析

| 对比项 | 差动方案 (本方案)       | 纯串联方案      |
| ------ | ----------------------- | --------------- |
| 承重   | ✅ **两舵机共同承重**   | 单舵机承重      |
| 紧凑度 | ✅ **更扁平**           | 较高 (3 层堆叠) |
| 重心   | ✅ **低** (舵机在下方)  | 较高            |
| 刚性   | ✅ **好** (铝板支架)    | 中              |
| 控制   | 需差动计算 (简单加减法) | 直接控制        |
| 舵机数 | 3                       | 3               |

## 6. 材料清单

| 零件          | 数量 | 材料/型号               | 说明                 |
| ------------- | ---- | ----------------------- | -------------------- |
| SM30BL 舵机   | 3    | 30kg.cm 无刷 RS485 总线 | 左、右、Yaw **静音** |
| 铝板 V 型支架 | 1    | 2mm 铝板 折弯           | 连接两舵机           |
| 圆盘摇臂      | 2    | 铝合金 Ø35mm            | 舵机输出端           |
| 连杆          | 2    | Ø3mm 不锈钢杆 60-80mm   | 推拉连杆             |
| M3 鱼眼轴承   | 4    | 标准件                  | 连杆两端各一个       |
| 万向铰接      | 1    | 十字万向节或球铰        | 头部与连杆连接       |
| Yaw 转盘      | 1    | 铝合金/PETG             | 舵机法兰扩展         |
| 底座          | 1    | PETG 3D打印             | 固定在躯干上         |

## 7. ROS URDF 模型

差动机构在 URDF 中仍然建模为两个独立关节，差动计算在控制层完成：

```xml
<!-- Neck Yaw (bottom) -->
<joint name="neck_yaw" type="revolute">
  <axis xyz="0 0 1"/>
  <limit lower="-1.57" upper="1.57"/>  <!-- ±90° -->
</joint>

<!-- Neck Pitch (differential, virtual joint) -->
<joint name="neck_pitch" type="revolute">
  <axis xyz="0 1 0"/>
  <limit lower="-0.70" upper="0.70"/>  <!-- ±40° -->
</joint>

<!-- Neck Roll (differential, virtual joint) -->
<joint name="neck_roll" type="revolute">
  <axis xyz="1 0 0"/>
  <limit lower="-0.52" upper="0.52"/>  <!-- ±30° -->
</joint>
```

```python
# ROS controller: virtual joints → real servo commands
def virtual_to_real(pitch, roll, yaw):
    """
    Convert virtual joint angles to real servo commands.
    """
    left_servo  = pitch + roll   # differential
    right_servo = pitch - roll   # differential
    yaw_servo   = yaw            # direct
    return left_servo, right_servo, yaw_servo
```

## 8. SolidWorks 零件清单

```
Neck/
├── neck_yaw_base.SLDPRT           # Yaw 底座
├── neck_yaw_turntable.SLDPRT      # Yaw 转盘
├── neck_servo_plate.SLDPRT        # 差动舵机安装板
├── neck_v_bracket.SLDPRT          # V 型铝板支架
├── neck_disc_horn.SLDPRT          # 圆盘摇臂 (×2)
├── neck_linkage_rod.SLDPRT        # 推拉连杆 (×2)
├── neck_head_flange.SLDPRT        # 头部连接法兰 (含万向铰接)
├── neck_universal_joint.SLDPRT    # 十字万向节
└── Neck_Assembly.SLDASM           # 脖子总装配
```

---

## 9. 参考链接

### 差动脖子方案

- [Differential Neck Joint for Humanoid Robot (论文)](https://www.matec-conferences.org/) — 搜索 `differential neck mechanism humanoid`，差速锥齿轮脖子关节
- [Animatronic Neck Mechanism 3-Servo — Thingiverse](https://www.thingiverse.com/search?q=animatronic+neck+mechanism) — 多种 3DOF 可下载方案
- [DMRJ - Differential Modular Robot Joint (学术)](https://www.semanticscholar.org/search?q=differential+modular+robot+joint) — 双电机差动关节

### 视频教程

- [Robot Head Neck Mechanism — YouTube](https://www.youtube.com/results?search_query=robot+neck+mechanism+3dof+servo+3d+print) — 多种脖子设计
- [InMoov Neck Design](https://inmoov.fr/) — 开源项目，脖子用 2 舵机差动 + 1 舵机旋转

### 舵机数据手册

- [Feetech SM30BL 数据手册](https://www.feetechrc.com/) — SM30BL 无刷舵机官方资料
- [Feetech SMS 协议文档](https://www.feetechrc.com/) — RS485 半双工串行总线协议
